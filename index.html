<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>BioSpace</title>
</head>
<body>

<!-- ===============================
     HEADER
     =============================== -->
<header> 
  <div id="casinha">
    <svg id="home" xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24" width="35" height="50">
      <path d="M12 3l9 8h-3v9h-12v-9h-3z"/>
    </svg>
  </div>
  <div id="placeholder_form">
    <form method="post"> 
      <input type="text" placeholder="üîé Search">
    </form>
  </div>
  <div id="title_principal">
    <h1 id="titulo-principal">BioSpace</h1>
  </div>  
</header>

<!-- ===============================
     MAIN MENU
     =============================== -->
<section id="menu">
  <div id="categorias">
    <h2>Categories</h2>
  </div>

  <div id="submenu-lateral">
    <!-- Submenu aparecer√° aqui -->
  </div>

  <div id="conteudo">
    <!-- Preview aparecer√° aqui -->
  </div>
</section>

<!-- ===============================
     SCRIPT
     =============================== -->
<script>
const categoriasDiv = document.getElementById("categorias");
const submenuLateral = document.getElementById("submenu-lateral");
const conteudoDiv = document.getElementById("conteudo");
const tituloPrincipal = document.getElementById("titulo-principal");
const home = document.getElementById("home");
const searchForm = document.querySelector("#placeholder_form form");
const searchInput = searchForm.querySelector("input");

// =====================
// Fun√ß√£o para mostrar o preview na tela
// =====================
function showPreview(url, title) {
    submenuLateral.classList.remove("active");
    submenuLateral.innerHTML = "";
    conteudoDiv.classList.add("sem-fundo");
    conteudoDiv.innerHTML = `<p>Loading summary...</p>`;

    fetch(`get_preview.php?url=${encodeURIComponent(url)}`)
        .then(res => res.json())
        .then(data => {
            conteudoDiv.innerHTML = `
                <div class="preview">
                    <h2 id="title_preview">${title}</h2>
                    <p>${data.preview}</p>
                </div>
            `;
        })
        .catch(() => {
            conteudoDiv.innerHTML = `
                <div class="preview">
                    <h2>${title}</h2>
                    <p>Error loading summary.</p>
                </div>
            `;
        });
}

// =====================
// Fun√ß√£o para criar bot√£o de subitem
// =====================
function createSubBtn(sub) {
    const subBtn = document.createElement("button");
    subBtn.textContent = sub.titulo;
    subBtn.addEventListener("click", () => showPreview(sub.url, sub.titulo));
    return subBtn;
}

// =====================
// Carregar categorias do PHP
// =====================
let allCategories = [];
fetch('get_categorias.php')
    .then(res => res.json())
    .then(categories => {
        allCategories = categories;
        renderCategories(categories);
    })
    .catch(err => console.error("Erro ao carregar categorias:", err));

// =====================
// Renderizar categorias e subitens
// =====================
function renderCategories(categories) {
    categoriasDiv.innerHTML = "";
    categories.forEach(cat => {
        const btn = document.createElement("button");
        btn.classList.add("rider");
        btn.textContent = cat.nome;

        btn.addEventListener("click", () => {
            submenuLateral.classList.add("active");
            submenuLateral.innerHTML = `<h3>${cat.nome}</h3>`;
            cat.subitens.forEach(sub => {
                submenuLateral.appendChild(createSubBtn(sub));
            });
        });

        categoriasDiv.appendChild(btn);
    });
}

// =====================
// Pesquisa
// =====================
searchForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const query = searchInput.value.trim().toLowerCase();
    if (!query) return;

    submenuLateral.classList.add("active");
    submenuLateral.innerHTML = `<h3>Search results for "${query}"</h3>`;

    let results = [];
    allCategories.forEach(cat => {
        cat.subitens.forEach(sub => {
            if (sub.titulo.toLowerCase().includes(query)) {
                results.push(sub);
            }
        });
    });

    if (results.length === 0) {
        submenuLateral.innerHTML += "<p>No results found.</p>";
    } else {
        results.forEach(sub => {
            submenuLateral.appendChild(createSubBtn(sub));
        });
    }

    conteudoDiv.classList.remove("sem-fundo");
    conteudoDiv.innerHTML = "";
});

// =====================
// Resetar para fundo inicial
// =====================
tituloPrincipal.addEventListener("click", resetMenu);
home.addEventListener("click", resetMenu);

function resetMenu() {
    submenuLateral.classList.remove("active");
    submenuLateral.innerHTML = "";
    conteudoDiv.classList.remove("sem-fundo");
    conteudoDiv.innerHTML = "";
    searchInput.value = "";
}

</script>
